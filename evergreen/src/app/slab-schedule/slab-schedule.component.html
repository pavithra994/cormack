<div class="container-fluid">
    <h1 style="margin-top: 0px;">Slab Schedule</h1>

    <!-- Search Bar -->
    <div style="background: #f7f7f7; border-radius: 5px; padding: 10px; margin-bottom: 1em;">
        <div style="float: right; padding: 8px;">
            <label class="radio-inline">
                <input type="radio" name="pour_date_set" [(ngModel)]="pour_date_set" (ngModelChange)="reloadFilters()" [value]="true" checked />
                Pour Date Set
            </label>
            <label class="radio-inline">
                <input type="radio" name="pour_date_set" [(ngModel)]="pour_date_set" (ngModelChange)="reloadFilters()" [value]="false" />
                No Pour Date
            </label>
        </div>

        <input [(ngModel)]="search_terms" (keyup.enter)="reloadFilters()" type="text" class="form-control" placeholder="Search" style="display: inline-block; width: 200px; margin-right: 10px;" />
        <select class="form-control" style="display: inline-block; width: 100px; margin-right: 10px;">
            <option name="any">Any Field</option>
            <option name="job_number">Job No.</option>
        </select>
        <input type="text" class="form-control" style="display: inline-block; width: 200px; margin-right: 10px;" />
        <button class="btn btn-danger" style="margin-right: 10px;">Clear</button>
        <button class="btn btn-default" (click)="reloadFilters()">Search</button>
    </div>

    <!-- Jobs Table -->
    <div style="overflow-x: auto">
        <table class="table table-striped table-bordered" style="white-space: nowrap;">
            <thead>
                <tr class="jobs-table-header">
                    <th (click)="sortBy('pour_date')">
                        Pour Date
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'pour_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'pour_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('code')">
                        Job #
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'code' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'code' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('client')">
                        Builder
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'client' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'client' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('address')">
                        Address
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'address' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'address' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('sqm')">
                        Sq.&nbsp;M
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'sqm' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'sqm' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('supervisor')">
                        Super
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'supervisor' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'supervisor' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('wanted_pour_date')">
                        Wanted Pour Date
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'wanted_pour_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'wanted_pour_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('building_inspector_supplier')">
                        Inspect
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'building_inspector_supplier' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'building_inspector_supplier' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('piers')">
                        Piers
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'piers' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'piers' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('piers_date')">
                        Date
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'piers_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'piers_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('peirs_inspection_date')">
                        Pier Insp
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'piers_inspection_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'piers_inspection_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('piers_inspection_date')">
                        Pier Insp Time
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'piers_inspection_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'piers_inspection_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('piers_inspection_done')">
                        OK
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'piers_inspection_done' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'piers_inspection_done' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('pier_concrete')">
                        Pier Concrete
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'pier_concrete' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'pier_concrete' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('rock_booked_date')">
                        Rock
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'rock_booked_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'rock_booked_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('part_a_date')">
                        Part A
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'part_a_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'part_a_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('pod_delivery_date')">
                        Pods
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'pod_delivery_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'pod_delivery_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('steel_delivery_date')">
                        Steel
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'steel_delivery_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'steel_delivery_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('base_date')">
                        Base
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'base_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'base_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('base_inspection_date')">
                        Base Insp
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'base_inspection_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'base_inspection_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('base_inspection_done')">
                        Ok
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'base_inspection_done' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'base_inspection_done' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('steel_inspection_date')">
                        Steel Insp
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'steel_inspection_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'steel_inspection_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('steel_inspection_done')">
                        Ok
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'steel_inspection_done' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'steel_inspection_done' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('sub_contractor')">
                        Subbie
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'sub_contractor' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'sub_contractor' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('pump_inspector')">
                        Pump
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'pump_inspector' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'pump_inspector' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('concrete_date')">
                        Concrete
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'concrete_date' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'concrete_date' && sort_order == 'asc'"></span>
                    </th>
                    <th (click)="sortBy('slab_schedule_notes')">
                        Notes
                        <span class="glyphicon glyphicon-chevron-up" *ngIf="sort_column == 'slab_schedule_notes' && sort_order == 'desc'"></span>
                        <span class="glyphicon glyphicon-chevron-down" *ngIf="sort_column == 'slab_schedule_notes' && sort_order == 'asc'"></span>
                    </th>
                </tr>
            </thead>

            <tbody *ngIf="group">
                <ng-template ngFor let-group [ngForOf]="row_groups">
                    <tr style="color: white; font-weight: bold; background: #444;">
                        <td colspan="27">{{group?.key && group.key != "null" ? (group?.key | date: 'EEEE, d MMMM yyyy') : "No Date"}}</td>
                    </tr>
                    
                    <tr ng-if="group.melbourne_jobs" style="color: white; font-weight: bold; background: #47F;">
                        <td colspan="27" style="padding: 2px 10px;">Melbourne</td>
                    </tr>
                    <tr *ngFor="let job of group.melbourne_jobs"
                        slab-schedule-row
                        [job]="job"
                        [builders]="builders"
                        [supervisors]="supervisors"
                        [subcontractors]="subcontractors"
                        [suppliers]="suppliers"
                        [showLabel]="false"
                        (reload)="reloadFieldChanged($event)">
                    </tr>

                    <tr ng-if="group.torquay" style="color: white; font-weight: bold; background: #4C4;">
                        <td colspan="27" style="padding: 2px 10px;">Torquay</td>
                    </tr>
                    <tr *ngFor="let job of group.torquay_jobs"
                        slab-schedule-row
                        [job]="job"
                        [builders]="builders"
                        [supervisors]="supervisors"
                        [subcontractors]="subcontractors"
                        [suppliers]="suppliers"
                        [showLabel]="false"
                        (reload)="reloadFieldChanged($event)">
                    </tr>
                </ng-template>
            </tbody>

            <tbody *ngIf="!group">
                <tr *ngFor="let job of jobs"
                    slab-schedule-row
                    [job]="job"
                    [builders]="builders"
                    [supervisors]="supervisors"
                    [subcontractors]="subcontractors"
                    [suppliers]="suppliers"
                    [showLabel]="true"
                    (reload)="reloadFieldChanged($event)">
            </tr>
    </tbody>
        </table>
    </div>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    
    <div style="background: #f7f7f7; border-radius: 5px; padding: 10px; margin-bottom: 1em;">
        <div class="btn-group" style="float: right;">
            <ng-template ngFor let-size [ngForOf]="page_sizes_available">
                <button type="button" class="btn btn-default"
                    [ngClass]="{'active': page_size==size}"
                    (click)="setPageSize(size)">
                        {{ size }}
                </button>
            </ng-template>
        </div>
        
        <div class="btn-group">
            <button type="button" class="btn btn-default" (click)="setPage(0)">First</button>
            <button type="button" class="btn btn-default" (click)="setPage(page - 1)">Previous</button>
            <ng-template ngFor let-p [ngForOf]="pageOptions()">
                <button type="button" class="btn btn-default" (click)="setPage(p)"
                [ngClass]="{'active': page==p}">{{ p + 1 }}</button>
            </ng-template>
            <button type="button" class="btn btn-default" (click)="setPage(page + 1)">Next</button>
            <button type="button" class="btn btn-default" (click)="setPage(page_maximum)">Last</button>
        </div>

        <div style="display: inline-block; margin-left: 15px;">
            {{ data?.count }} jobs
        </div>
    </div>
</div>
